### API Specs 요구사항 분석
1. **유저 대기열 토큰 기능**
    - 모든 유저는 처음에 대기열로 들어와서 토큰을 발급받는다. 토큰이 사용가능한 상태가 되면 다음 행위(좌석조회, 예약, 결제 등)를 할 수 있다.
        - 필요한 정보:
            - request: user_id
            - response: user_id, 토큰, 토큰 상태, 대기순번
        1) 대기열 테이블에서 user_id로 가장 최근에 생성된 데이터 1건을 조회한다.
        2) 대기열에 없는 user_id 인 경우 토큰을 발급하여 대기열 테이블에 저장하고, 새로 생성한 토큰 정보들을 반환한다.
        3) 대기열에 있는 user_id 인 경우 토큰의 상태를 확인한다.
              - 토큰의 상태가 `대기`인 경우: 대기 순번을 다시 체크하여 토큰의 상태를 변경시킨 뒤 토큰 정보를 반환한다.
              - 토큰의 상태가 `이용가능`인 경우: 해당 정보를 반환한다.
              - 토큰의 상태가 `만료`인 경우: 새로 토큰을 발급하고 해당 정보를 반환한다.

2. 예약 가능 날짜 / 좌석 API
    - **예약 가능 날짜 조회 API**
        - 필요한 정보:
            - request: 토큰, 조회할 날짜 from, end,
            - response: 공연정보(id, 공연명, 공연일, 공연시작시간) list
        1) 토큰상태를 확인한다
            - 토큰 상태가 `이용가능`인 경우: 계속 진행
            - 토큰 상태가 `이용가능`이 아닌 경우: `이용불가능한 토큰` Exception을 발생시킨다.
        2) 공연일이 from~end 사이에 있는 공연들의 정보를 반환한다.

    - **예약 가능 좌석 조회 API**
        - 필요한 정보:
            - request: 토큰, 공연정보 id
            - response: 공연좌석(id, 좌석번호, 점유여부, 가격)
        1) 토큰상태를 확인한다
            - 토큰 상태가 `이용가능`인 경우: 계속 진행
            - 토큰 상태가 `이용가능`이 아닌 경우: `이용불가능한 토큰` Exception을 발생시킨다.
        2) 공연정보 id가 가진 좌석 정보를 반환한다.

3. **좌석 예약 요청 API**
    - 필요한 정보:
        - request: 토큰, 공연좌석id
        - response: 예약내역(id, user_id, 결제금액, 결제상태, 예약일시), 좌석번호
    1) 토큰상태를 확인한다
        - 토큰 상태가 `이용가능`인 경우: 계속 진행
        - 토큰 상태가 `이용가능`이 아닌 경우: `이용불가능한 토큰` Exception을 발생시킨다.
    2) 공연좌석id로 좌석을 조회한다(lock)
        - 좌석 상태가 occupied = true 인 경우: `이미 선택된 좌석입니다` Exception을 발생시킨다.
        - 좌석 상태가 occupied = false 인 경우: 계속 진행
    3) 공연좌석id와 (토큰으로 조회한)user_id로 새로운 예약내역을 생성
    4) 공연좌석 occupied = true 로 전환
    5) 예약내역을 반환한다.

4. 잔액 충전 / 조회 API
    - **잔액 충전 API**
        - 필요한 정보:
            - request: 토큰, 충전금액
            - response: user_id, 총 포인트
        1) 토큰상태를 확인한다
            - 토큰 상태가 `이용가능`인 경우: 계속 진행
            - 토큰 상태가 `이용가능`이 아닌 경우: `이용불가능한 토큰` Exception을 발생시킨다.
        2) 토큰으로 사용자 조회.
        3) 사용자의 포인트 충전내역을 생성하고, 사용자의 총포인트를 충전금액만큼 증가시킨다.
    - **잔액 조회 API**
        - 필요한 정보:
            - request: 토큰
            - response: user_id, 총 포인트
        1) 토큰상태를 확인한다
            - 토큰 상태가 `이용가능`인 경우: 계속 진행
            - 토큰 상태가 `이용가능`이 아닌 경우: `이용불가능한 토큰` Exception을 발생시킨다.
        2) 토큰으로 사용자 조회 후 사용자의 포인트 정보를 반환한다.

5. **결제 API**
    - 필요한 정보:
        - request: 토큰, 좌석예약 id
        - response: 예약내역(id, user_id, 결제금액, 결제상태, 예약일시), 좌석번호
    1) 토큰상태를 확인한다
        - 토큰 상태가 `이용가능`인 경우: 계속 진행
        - 토큰 상태가 `이용가능`이 아닌 경우: `이용불가능한 토큰` Exception을 발생시킨다.
    2) 예약내역을 조회하고 결제상태를 확인한다.
        - 결제상태 `취소`인 경우: `결제불가능` Exception 발생시킨다.
        - 결제상태 `완료`인 경우: `이미 결제 완료` Exception 발생시킨다.
        - 결제상태 `대기`인 경우:  계속 진행
    3) 토큰으로 조회한 사용자 id와 예약내역의 사용자 id를 비교한다.
        - 일치하지 않는경우: `사용자 불일치` Exception을 발생시킨다.
    4) 사용자의 포인트로 결제를 시도한다
        - 사용자의 `총 포인트 < 결제금액`인 경우:  `포인트부족` Exception을 발생시킨다.
        - 사용자의 `총 포인트 >= 결제금액`인 경우:
            - 포인트 차감 이력을 생성한다.
            - 결제금액만큼 사용자의 포인트잔액 차감한다.
            - 예약건의 결제상태를 `완료`로 변경한다.
            - 결제내역 정보를 생성한다.
            - 대기열정보를 만료시킨다.
            - 예약내역정보를 반환한다.

6. 스케줄러
    - **임시배정좌석 만료 스케줄러**
        - `30초`에 한번씩
        - `결제대기`상태인 예약건들을 조회하고
        - 현재시간기준 만료시간이 지난 건들을 `예약취소`상태로 바꾼다. 
        - 해당 예약건들과 연관된 공연좌석의 occupied 를 false로 전환한다.
